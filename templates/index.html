<!DOCTYPE html>
<html>
<head>
    <title>Cadastro</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; }
        form { display: grid; gap: 10px; }
        input, button { padding: 10px; }
        button { background: #4CAF50; color: white; border: none; cursor: pointer; }
    </style>
</head>
<body>
    <h1>Cadastro</h1>
    <form id="clientForm">
        <input type="text" name="nome" placeholder="Nome" required>
        <input type="email" name="email" placeholder="E-mail" required>
        <input type="tel" name="telefone" placeholder="Telefone" required>
        
        <h3>Endereço</h3>
        <input type="text" name="rua" placeholder="Rua" required>
        <input type="text" name="bairro" placeholder="Bairro" required>
        <input type="text" name="numero" placeholder="Número" required>
        <input type="text" name="complemento" placeholder="Complemento">
        <input type="text" name="cidade" placeholder="Cidade" required>
        <input type="text" name="estado" placeholder="Estado" required maxlength="2">
        <input type="text" name="cep" placeholder="CEP" required>
        
        <button type="submit">Cadastrar</button>
    </form>
    <div id="result"></div>

    <script>
    document.getElementById('clientForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        console.log("Iniciando envio...");
        
        const formData = {
            nome: this.nome.value,
            email: this.email.value,
            telefone: this.telefone.value,
            endereco: {
                rua: this.rua.value,
                bairro: this.bairro.value,
                numero: this.numero.value,
                complemento: this.complemento.value,
                cidade: this.cidade.value,
                estado: this.estado.value,
                cep: this.cep.value
            }
        };
        
        try {
            const response = await fetch('/insert', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(formData)
            });
            
            const result = await response.json();
            console.log("Resposta:", result);
            
            document.getElementById('result').innerHTML = 
                result.status === 'success'
                    ? `<p style="color:green">Sucesso! ID: ${result.inserted_id}</p>`
                    : `<p style="color:red">Erro: ${result.message}</p>`;
                    
        } catch (error) {
            console.error("Erro:", error);
            document.getElementById('result').innerHTML = 
                `<p style="color:red">Erro na conexão: ${error.message}</p>`;
        }
    });
    </script>
</body>
</html>